<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Biker - a bike route planner</title>
    <link rel="stylesheet" href="openlayers/theme/default/style.css" type="text/css">
    <link rel="stylesheet" href="style.css" type="text/css">

    <!--<script src="openlayers/OpenLayers.js"></script>-->
    <script src="http://openlayers.org/api/OpenLayers.js"></script> 
    <script type="text/javascript">
        // Initalisierung der zugreifbaren Variablen 
        var routeLayer = null;
        var xmlHttp = null;
        var thisLink = "";
        var settingsShown = 0;
        var pointlist = [];
        var markerlist = [];
        var lastmarker = [];
        var iconSizeLarge = new OpenLayers.Size(20, 20);
        var iconSize = new OpenLayers.Size(15, 15);
        var iconOffset = new OpenLayers.Pixel(-(iconSize.w/2), - iconSize.h);
        var map, layer, gpxlayer;
        // Initalisierung der Marker
        var markerStart = new OpenLayers.Icon("img/marker-green.png", iconSizeLarge, iconOffset);
        var markerEnd = new OpenLayers.Icon("img/marker-red.png", iconSizeLarge, iconOffset);
        var markerInBetween = new OpenLayers.Icon("img/marker-yellow.png", iconSize, iconOffset);
        var markerRed = new OpenLayers.Icon("img/marker-red.png", iconSize, iconOffset);
        var markerBlue = new OpenLayers.Icon("img/marker-blue.png", iconSize, iconOffset);
        var markerCyan = new OpenLayers.Icon("img/marker-cyan.png", iconSize, iconOffset);
        var markerGreen = new OpenLayers.Icon("img/marker-green.png", iconSize, iconOffset);
        var markerPurple = new OpenLayers.Icon("img/marker-purple.png", iconSize, iconOffset);
        var markerYellow = new OpenLayers.Icon("img/marker-yellow.png", iconSize, iconOffset);
        //var iconlist = [markerBlue, markerPurple, markerRed, markerYellow, markerGreen, markerCyan];
        var markers = new OpenLayers.Layer.Markers( "Markers" );
        OpenLayers.Control.Click = OpenLayers.Class(OpenLayers.Control, {                
                defaultHandlerOptions: {
                    'single': true,
                    'double': false,
                    'pixelTolerance': 2,
                    'stopSingle': false,
                    'stopDouble': false
                },

                initialize: function(options) {
                    this.handlerOptions = OpenLayers.Util.extend(
                        {}, this.defaultHandlerOptions
                    );
                    OpenLayers.Control.prototype.initialize.apply(
                        this, arguments
                    ); 
                    this.handler = new OpenLayers.Handler.Click(
                        this, {
                            'click': this.trigger
                        }, this.handlerOptions
                    );
                }, 

                trigger: function(e) {
                    var lonlat = map.getLonLatFromViewPortPx(e.xy);
                    lonlat.transform(new OpenLayers.Projection("EPSG:900913"), new OpenLayers.Projection("EPSG:4326"));
                    pointlist[pointlist.length] = lonlat;
                    var lonlatSimple = map.getLonLatFromViewPortPx(e.xy);
                    markerlist[markerlist.length] = lonlatSimple;
                    calcRouteJson();
                }

            });
         // Initalisurungs Funktion      
        function init(){
            var geolocate = new OpenLayers.Control.Geolocate({id: 'locate-control', geolocationOptions: {enableHighAccuracy: false, maximumAge: 0, timeout: 7000}});
            
            map = new OpenLayers.Map('map',
                {controls:[new OpenLayers.Control.ArgParser,
                new OpenLayers.Control.Attribution,
                new OpenLayers.Control.LayerSwitcher,
                new OpenLayers.Control.Navigation({dragPanOptions: {enableKinetic: true}}),
                new OpenLayers.Control.MousePosition,
                //new OpenLayers.Control.PanZoom,   //Einkommentieren bringt das Problem mit den doppelten Zoombuttons
                new OpenLayers.Control.PanZoomBar,
                new OpenLayers.Control.OverviewMap({maximized: false}),
                geolocate,
                new OpenLayers.Control.TouchNavigation({dragPanOptions: {enableKinetic: true}}),
                new OpenLayers.Control.ScaleLine({geodesic:true})],
                units:"m",
                maxResolution:156543.0339,
                numZoomLevels:20,
                displayProjection:new OpenLayers.Projection("EPSG:4326")
                });
            var osmdeutsch = new OpenLayers.Layer.OSM("OSM deutscher Stil", [
               "http://a.tile.openstreetmap.de/tiles/osmde/${z}/${x}/${y}.png",
               "http://b.tile.openstreetmap.de/tiles/osmde/${z}/${x}/${y}.png",
               "http://c.tile.openstreetmap.de/tiles/osmde/${z}/${x}/${y}.png"],
               {attribution: 'Tile server sponsored by STRATO / <b>Europe only</b> / <a href="./germanstyle.html">About style</a>',
                transitionEffect: 'resize'});
            map.addLayer(osmdeutsch);
            var osm=new OpenLayers.Layer.OSM(
                "OSM Mapnik",
                ["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png",
                 "http://b.tile.openstreetmap.org/${z}/${x}/${y}.png",
                 "http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],
                {attribution:"Data CC-By-SA by <a href=http://www.openstreetmap.org>OpenStreetMap</a>",
                keyid:"mapnik",
                displayOutsideMaxExtent:true,
                wrapDateLine:true,
                layerCode:"M",
                transitionEffect: 'resize'}
                );
            map.addLayer(osm);
            oepnv = new OpenLayers.Layer.OSM("&Ouml;PNVkarte",
                "http://tile.memomaps.de/tilegen/${z}/${x}/${y}.png",
                {attribution:"Data CC-By-SA by <a href=http://www.openstreetmap.org>OpenStreetMap</a><br>Original map can be seen at <a href=http://www.xn--pnvkarte-m4a.de>www.&ouml;pnvkarte.de</a>",
                 numZoomLevels: 19,
                 displayInLayerSwitcher:true,
                 buffer:0,
                 transitionEffect: 'resize'}
                );
            map.addLayer(oepnv);
            var transport=new OpenLayers.Layer.OSM(
                "OSM Transport",
                ["http://a.tile2.opencyclemap.org/transport/${z}/${x}/${y}.png",
                 "http://b.tile2.opencyclemap.org/transport/${z}/${x}/${y}.png",
                 "http://c.tile2.opencyclemap.org/transport/${z}/${x}/${y}.png"],
                {attribution: "Tiles courtesy of <a href='http://www.opencyclemap.org/' target='_blank'>Andy Allan</a>",
                keyid:"transportmap",
                displayOutsideMaxExtent:!0,
                wrapDateLine:true,
                layerCode:"T"},
                {transitionEffect: 'resize'});
            map.addLayer(transport);
            var cyclemap=new OpenLayers.Layer.OSM(
                "OSM Radfahrerkarte",
                ["http://a.tile.opencyclemap.org/cycle/${z}/${x}/${y}.png",
                 "http://a.tile.opencyclemap.org/cycle/${z}/${x}/${y}.png",
                 "http://a.tile.opencyclemap.org/cycle/${z}/${x}/${y}.png"],
                {attribution:"Tiles courtesy of <a href='http://www.opencyclemap.org/' target='_blank'>Andy Allan</a>",
                keyid:"cyclemap",
                displayOutsideMaxExtent:true,
                wrapDateLine:true,
                layerCode:"C",
                transitionEffect: 'resize'}
                );
            map.addLayer(cyclemap);
            routeLayer = new OpenLayers.Layer.Vector("Route Layer", {displayInLayerSwitcher:false}, {maxResolution: 156543.0339});
            map.addLayer(routeLayer);
            xmlHttp = new XMLHttpRequest();
            var vectorLayer = new OpenLayers.Layer.Vector("Vector Layer", {displayInLayerSwitcher:false});
            map.addLayer(vectorLayer);
            var geolocationstyle = {
                fillColor: '#000',
                fillOpacity: 0.1,
                strokeWidth: 0
            };
            geolocate.events.register("locationupdated", this, function(e) {
                vectorLayer.removeAllFeatures();
                vectorLayer.addFeatures([
                    new OpenLayers.Feature.Vector(
                        e.point,
                        {},
                        {
                            graphicName: 'star',
                            strokeColor: '#f00',
                            strokeWidth: 1,
                            fillOpacity: 0,
                            pointRadius: 7
                        }
                    ),
                    new OpenLayers.Feature.Vector(
                        OpenLayers.Geometry.Polygon.createRegularPolygon(
                            new OpenLayers.Geometry.Point(e.point.x, e.point.y),
                            e.position.coords.accuracy / 2,
                            50,
                            0
                        ),
                        {},
                        geolocationstyle
                    )
                ]);
                map.zoomToExtent(vectorLayer.getDataExtent());
            });
            geolocate.deactivate();
            geolocate.activate();
            /*var mapquestaerial=new OpenLayers.Layer.OSM(
                "Mapquest Aerial",
                ["http://oatile1.mqcdn.com/naip/${z}/${x}/${y}.png",
                "http://oatile1.mqcdn.com/naip/${z}/${x}/${y}.png",
                "http://oatile1.mqcdn.com/naip/${z}/${x}/${y}.png",
                "http://oatile1.mqcdn.com/naip/${z}/${x}/${y}.png"],
                {attribution:"Tiles courtesy of <a href='http://www.mapquest.com/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png'>",
                keyid:"mapquest",
                displayOutsideMaxExtent:!0,
                wrapDateLine:!0,
                numZoomLevels:19,
                layerCode:"Q"});
            map.addLayer(mapquestaerial);*/   //MapQuest kann vielleicht benutzt werden. Rechte klären!
            /*var mapquest=new OpenLayers.Layer.OSM(
                "Mapquest",
                ["http://otile1.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.png",
                "http://otile2.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.png",
                "http://otile3.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.png",
                "http://otile4.mqcdn.com/tiles/1.0.0/osm/${z}/${x}/${y}.png"],
                {attribution:"Tiles courtesy of <a href='http://www.mapquest.com/' target='_blank'>MapQuest</a> <img src='http://developer.mapquest.com/content/osm/mq_logo.png'>",
                keyid:"mapquest",
                displayOutsideMaxExtent:!0,
                wrapDateLine:!0,
                numZoomLevels:19,
                layerCode:"Q"});
            map.addLayer(mapquest);*/   //MapQuest kann vielleicht benutzt werden. Rechte klären!
            /*var gphy = new OpenLayers.Layer.Google(
                "Google Physical",
                {type: google.maps.MapTypeId.TERRAIN}
                // used to be {type: G_PHYSICAL_MAP}
            );
            map.addLayer(gphy);
            var gmap = new OpenLayers.Layer.Google.V3(
                "Google Streets", // the default
                {numZoomLevels: 20}
                // default type, no change needed here
            );
            map.addLayer(gmap);
            var ghyb = new OpenLayers.Layer.Google.V3(
                "Google Hybrid",
                {type: google.maps.MapTypeId.HYBRID, numZoomLevels: 20}
                // used to be {type: G_HYBRID_MAP, numZoomLevels: 20}
            );
            map.addLayer(ghyb);
            var gsat = new OpenLayers.Layer.Google.V3(
                "Google Satellite",
                {type: google.maps.MapTypeId.SATELLITE, numZoomLevels: 22}
                // used to be {type: G_SATELLITE_MAP, numZoomLevels: 22}
            );
            map.addLayer(gsat);*/   //Google-Karten in Kombination mit OSM geht irgendwie nicht. Warum?
            
            map.addLayer(markers);
            
            //var lonLat = new OpenLayers.LonLat( 7.2662, 51.447 )
            //      .transform(
            //        new OpenLayers.Projection("EPSG:4326"), // transform from WGS 1984
            //        map.getProjectionObject() // to Spherical Mercator Projection
            //      );
            //markers.addMarker(new OpenLayers.Marker(lonLat, markerCyan));
            
            map.setCenter(
                new OpenLayers.LonLat(7.2662, 51.447).transform(
                    new OpenLayers.Projection("EPSG:4326"),
                    map.getProjectionObject()
                ), 11
            );
            
            gpxlayer = null;
            
            //displayGPX("../1341253652/api/0.3/51.4568,7.2684,51.445,7.2645/bike/euclidian.gpx");
            //displayGPX("route.gpx");
            
            var click = new OpenLayers.Control.Click();
            map.addControl(click);
            click.activate();
        }
        // Funktion zum Anzeigen der JSON-Datei
        function displayJSON(jsonfile)
        {
            if (jsonfile == "")
                return;
            //alert(jsonfile);
            xmlHttp.open('GET', jsonfile, false);
            xmlHttp.send();
            xmlHttp.readyState = 4;
            //xmlHttp.onreadystatechange = function() {
                //if (xmlHttp.readyState == 4) {
                    //TODO: JSON malen
                    //
                    
                    //if (xmlHttp.readyState==4) {
                    //    alert(xmlHttp.responseText);
                    //    }
                    //    else{alert("readystate = " + xmlHttp.readyState);}
                    var jsonRoute = JSON.parse(xmlHttp.responseText);
                    //"{\"version\":\"0.3\",\"status\":0,\"route_summary\":{},\"route_geometry\":[[51.443359375,7.255579948],[51.443332672,7.255686283],[51.443344116,7.255809784],[51.443389893,7.255942345],[51.443706512,7.256940365],[51.443584442,7.257035732],[51.443641663,7.257212162],[51.443595886,7.257271767],[51.443653107,7.257495403],[51.443695068,7.257628918],[51.443714142,7.257884979],[51.443683624,7.257968903],[51.443660736,7.258131981],[51.443675995,7.258408546],[51.443759918,7.258531094],[51.443870544,7.258547306],[51.443916321,7.258600712],[51.444110870,7.259222507],[51.444110870,7.259222507],[51.444076538,7.259338856],[51.444099426,7.259451389],[51.444133759,7.259503365],[51.444263458,7.259594917],[51.444313049,7.259674549],[51.444305420,7.259967327],[51.444347382,7.260162830],[51.444393158,7.260304928],[51.444816589,7.259983540],[51.444850922,7.260039806],[51.444923401,7.259994507],[51.444934845,7.260047436],[51.444992065,7.260219574],[51.445159912,7.260096073],[51.445331573,7.260557175],[51.445377350,7.260514736],[51.445507050,7.260873795],[51.445388794,7.260986805],[51.445442200,7.261174202],[51.445209503,7.261363506],[51.445236206,7.261446953],[51.445236206,7.261446953],[51.445243835,7.261479378],[51.444992065,7.261680603],[51.444980621,7.261658669],[51.445011139,7.261635303],[51.445064545,7.261713028],[51.445106506,7.261785507],[51.445365906,7.262567043],[51.445415497,7.262731075],[51.445442200,7.262814522],[51.445758820,7.263802528],[51.446121216,7.264935493],[51.445991516,7.265042305],[51.446037292,7.265192032],[51.446083069,7.265154362],[51.446083069,7.265154362],[51.446361542,7.266045094],[51.446308136,7.266088486],[51.446521759,7.266702175],[51.446655273,7.267156124],[51.446792603,7.267556190],[51.446811676,7.267549038],[51.446876526,7.267507076],[51.446941376,7.267464638],[51.446979523,7.267568111],[51.447174072,7.267395973],[51.447139740,7.267297745],[51.447113037,7.267211437],[51.447616577,7.266767502],[51.447616577,7.266767502],[51.447113037,7.267211437],[51.447139740,7.267297745],[51.447174072,7.267395973],[51.447360992,7.267231464],[51.447750092,7.268370628],[51.447807312,7.268320084],[51.447860718,7.268265724],[51.448001862,7.268138885],[51.448020935,7.268149376],[51.448352814,7.267828941],[51.448200226,7.268768311],[51.448326111,7.268652916],[51.448474884,7.268515110],[51.448608398,7.268389702],[51.448657990,7.268496037],[51.448902130,7.269065857],[51.449050903,7.269396782],[51.449108124,7.269561291],[51.449226379,7.269886494],[51.449291229,7.270258427],[51.449329376,7.270563602],[51.449321747,7.270674706],[51.449337006,7.270827770],[51.449356079,7.270925522],[51.449413300,7.270931721],[51.449462891,7.270971775],[51.449485779,7.270998955],[51.449504852,7.271034241],[51.449531555,7.271115303],[51.449604034,7.271329403],[51.449638367,7.271561623],[51.449825287,7.272096634],[51.45,7.27267]],\"route_instructions\":[]}");
                    //xmlHttp.responseText);
                    if (jsonRoute) {
                        var points = [];
                        for (var i = 0; i < jsonRoute.route_geometry.length; i++) {
                            var point = new OpenLayers.Geometry.Point(
                                    jsonRoute.route_geometry[i][1], 
                                    jsonRoute.route_geometry[i][0]);
                            points.push(point.transform(
                                new OpenLayers.Projection("EPSG:4326"),
                                map.getProjectionObject()));
                        }
                        var geometry = new OpenLayers.Geometry.LineString(points);
                        //alert("1");
                        var feature = new OpenLayers.Feature.Vector(geometry, null, {
                            strokeColor: "#0033ff",
                            strokeOpacity: 0.7,
                            strokeWidth: 5
                        });
                        //alert("2");
                        if (routeLayer != null)
                            map.removeLayer(routeLayer);
                        //alert("3");    
                        routeLayer = new OpenLayers.Layer.Vector("Route Layer", {displayInLayerSwitcher:false}, {maxResolution: 156543.0339});
                        map.addLayer(routeLayer);
                        routeLayer.addFeatures(feature);
                        //alert("4");
                    }
                    //else
                        //alert("Did not get valid JSON response.");
                //}
            //}
        }
        // Funktion zum Anzeigen der GPX-Datei
        function displayGPX(gpxfile)
        {
            if (gpxlayer != null)
                map.removeLayer(gpxlayer);
            // Add the Layer with the GPX Track
			gpxlayer = new OpenLayers.Layer.GML("Route", gpxfile, {
				format: OpenLayers.Format.GPX,
				style: {strokeColor: "#0000FF", strokeWidth: 5, strokeOpacity: 0.5},
				projection: new OpenLayers.Projection("EPSG:4326"),
                displayInLayerSwitcher:false
			});
			map.addLayer(gpxlayer);
        }
        // Funktion zum (neu-)Setzen der Marker
        function setMarkers()
        {
                markers.destroy();
                markers = new OpenLayers.Layer.Markers( "Markers" );
                map.addLayer(markers);
                var iconindex;
                var help = 0;
                for(var index = 0; index < markerlist.length; index ++)
                {
                    if(index == 0)
                    {
                        lastmarker[index] = new OpenLayers.Marker(markerlist[index], markerStart);
                        markers.addMarker(lastmarker[index]);
                    }
                    else if (index >=1 && index <= markerlist.length-2)
                    {
                        if(help == 0)
                        {
                            lastmarker[index] = new OpenLayers.Marker(markerlist[index], markerInBetween);
                            markers.addMarker(lastmarker[index]);
                            help = 1;
                        }
                        else
                        {
                            lastmarker[index] = new OpenLayers.Marker(markerlist[index], markerInBetween.clone());
                            markers.addMarker(lastmarker[index]);
                        } 
                    }
                    else
                    {
                        lastmarker[index] = new OpenLayers.Marker(markerlist[index], markerEnd);
                        markers.addMarker(lastmarker[index]);
                    }
                }
                
        }
        // Funktion, die die Werte an den Server weitergibt (via Json)
        function calcRouteJson()
        {
            var url = calcRoute();
            url = url.replace(/.gpx/g , ".js");
            displayJSON(url);
        }
        // Funktion, die die Werte an den Server weitergibt (via GPX)
        function calcRoute()
        {
            var urlstart = "../1341253652/api/0.3/";
            var urlend = "/" + getCheckedRoutingMetric() + ".gpx";
            var url = "";
            if (pointlist.length > 1)
            {
                if(pointlist.length == 2)
                {
                     url = urlstart + pointlist[0].lat + "," + pointlist[0].lon + "," + pointlist[1].lat + "," + pointlist[1].lon + urlend;
                }
                else
                {
                    url = urlstart;
                    for (var index = 0; index <= pointlist.length - 1; index++)
                        {
                            url = url + pointlist[index].lat + "," + pointlist[index].lon;
                            if(index == pointlist.length - 2)
                            {
                                url =  url + "]";
                            }
                            if(index != pointlist.length - 1)
                            {
                                url = url  + ",";
                            }
                            if(index == 0)
                            {
                                url = url + "[";
                            }
                            
                        }
                        url = url + urlend;
                }
                
                urlparameters = "";
                urlparameters += "algorithm=" + getCheckedRoutingAlgorithm()
                //ACHTUNG! Erlaubt code und Parameter Injection.
                urlparameters += "&maxpower=" + document.routingmetricsettings.maxpower.value;
                urlparameters += "&minspeed=" + document.routingmetricsettings.minspeed.value/3.6;
                urlparameters += "&weight=" + document.routingmetricsettings.weight.value;
                urlparameters += "&pushbikespeed=" + document.routingmetricsettings.pushbikespeed.value/3.6;
                urlparameters += "&detourperheightmeter=" + document.routingmetricsimpleheightsettings.adddistance.value;
                url += "?" + urlparameters;
            }
            thisLink = url;
            getLink();
            setMarkers();
            return url;
        }
        // Ausgabe über den "About" Button
        function about()
        {
            //TODO : Erklärung überarberarbeiten
            // anmerkung: leider kann man den Titel des Fensters nicht bearbeiten
            alert("Erklärung hier hin vielleicht? Google-Karten kann man evtl nutzen, steht <a href="+"http://code.google.com/intl/de-DE/apis/maps/documentation/javascript/"+">hier</a>;<br>" 
           + "MapQuest-Karten können evtl. auch benutzt werden, die sehen auch ganz nett aus (<a href="+"http://www.mapquest.com/"+">guckst du</a>)<br>"
        + "Diese Datei muss unter CC-Lizenz stehen, denn sie enthält Code, der vorher unter CC-Lizenz stand (von www.openstreetmap.org)<br>");
        }
        // Funktion zum Reseten der Route
        function resetRoute()
        {
            lastmarker = [];
            markerlist = [];
            pointlist = [];
            calcRouteJson();
        }
        // Funktion zum Entfernen des letzten Elements
        function removeLastElement()
        {
            if(pointlist.length >= 1)
            {
                lastmarker.splice(lastmarker.length - 1, 1);
                markerlist.splice(markerlist.length - 1 , 1);
                pointlist.splice(pointlist.length -1, 1);
                calcRouteJson();
            }
        }
        // Funktion verweist auf die Adresse der GPX-Datei
        function getLink()
        {
                document.getElementById("tag").href= thisLink;
        }
        // Funktion zeigt oder verbirgt die Setting-Abschnitte
        function setSettings()
        {
            if(settingsShown == 0)
            {
                settingsShown = 1;
                document.getElementById("allSettings").style.visibility = "visible";
                clickMetric();
            }
            else
            {
                settingsShown = 0;
                document.getElementById("allSettings").style.visibility = "hidden";
                document.getElementById("settingsSimpleheight").style.visibility = "hidden";
                document.getElementById("settingsPowermetric").style.visibility = "hidden";
                document.getElementById("settingsNew").style.visibility = "hidden";
                document.getElementById("settingsBikers").style.visibility = "hidden";
            }
        }
        //
        function getCheckedRoutingAlgorithm()
        {
            for(i=0; i<document.algorithm.algorithm.length; i++)
            {
                if(document.algorithm.algorithm[i].checked == true)
                {
                    return document.algorithm.algorithm[i].value;
                }
            }
        }
        //
        function getCheckedRoutingMetric()
        {
            for(i=0; i<document.routingmetric.routingmetric.length; i++)
            {
                if(document.routingmetric.routingmetric[i].checked == true)
                {
                    return document.routingmetric.routingmetric[i].value;
                }
            }
        }
        //
        function getCheckedRoutingAlgorithm()
        {
            for(i=0; i<document.algorithm.algorithm.length; i++)
            {
                if(document.algorithm.algorithm[i].checked == true)
                {
                    return document.algorithm.algorithm[i].value;
                }
            }
        }
        // Funktion schaltet je nach Metrik die Formulare auf Sichtbar / Unsichtbar
        function clickMetric()
        {
            var help = getCheckedRoutingMetric();
            if(help == "bike/euclidian")
            {
                document.getElementById("settingsSimpleheight").style.visibility = "hidden";
                document.getElementById("settingsPowermetric").style.visibility = "hidden";
                document.getElementById("settingsNew").style.visibility = "hidden";
                document.getElementById("settingsBikers").style.visibility = "hidden";
            }
            else if(help == "bike/simpleheight")
            {
                document.getElementById("settingsSimpleheight").style.visibility = "visible";
                document.getElementById("settingsPowermetric").style.visibility = "hidden";
                document.getElementById("settingsNew").style.visibility = "hidden";
                document.getElementById("settingsBikers").style.visibility = "hidden";
            }
            else if (help == "bike/power")
            {
                document.getElementById("settingsPowermetric").style.visibility = "visible";
                document.getElementById("settingsSimpleheight").style.visibility = "hidden";
                document.getElementById("settingsNew").style.visibility = "hidden";
                document.getElementById("settingsBikers").style.visibility = "visible";
            }
            else if (help == "bike/platzhalter")
            {
                document.getElementById("settingsPowermetric").style.visibility = "visible";
                document.getElementById("settingsSimpleheight").style.visibility = "hidden";
                document.getElementById("settingsNew").style.visibility = "visible";
                document.getElementById("settingsBikers").style.visibility = "visible";
            }
        }
        //
        function getCheckedRoutingMetric()
        {
            for(i=0; i<document.routingmetric.routingmetric.length; i++)
            {
                if(document.routingmetric.routingmetric[i].checked == true)
                {
                    return document.routingmetric.routingmetric[i].value;
                }
            }
        }
    </script>
  </head>
  <body onload="init()">
    <div id="map" class="smallmap"></div>
    <div id= "controlButton">
        <button id="b1" type="reset" onclick="resetRoute()">Reset</button>
        <button id="b2" type="reset" onclick="removeLastElement()">Remove last Marker</button>
        <button id="b2" type="reset" onclick="calcRoute()">Recalculate Route</button>
        <a id = "tag">Link zur GPX-Datei</a>
        <button id="b3" type="button" onclick="setSettings()">Settings</button>
        <button id="b4" type="button" onclick="about()">About</button>
    </div>
    <div id = "allSettings">
    <div id ="radioAlgorithm">
        <form name="algorithm">
            <table>
                <tr><td>Algorithmenauswahl: </td></tr>
                <tr><td><input type="radio" name="algorithm" value="astar"> A*</td></tr>
                <tr><td><input type="radio" name="algorithm" value="dijkstra"> Dijkstra</td></tr>
                <tr><td><input type="radio" name="algorithm" value="multithreadedastar"> Mehrthread-A*</td></tr>
                <tr><td><input type="radio" name="algorithm" value="multithreadeddijkstra"> Mehrthread-Dijkstra</td></tr>
                <tr><td><input type="radio" name="algorithm" value="standard" checked> Standardalgorithmus</td></tr>
            </table>
        </form>
    </div>
    <div id = "radioRoutingmetric">
        <form name="routingmetric">
            <table>
                <tr><td>Routingmetriken: </td></tr>
                <tr><td><input type="radio" name="routingmetric" value="bike/euclidian" onclick="clickMetric()"> euklidische Entfernung</td></tr>
                <tr><td><input type="radio" name="routingmetric" value="bike/simpleheight" onclick="clickMetric()"> einfache Höhenvermeidung</td></tr>
                <tr><td><input type="radio" name="routingmetric" value="bike/power" onclick="clickMetric()" checked> Leistungsmetrik</td></tr>
                <tr><td><input type="radio" name="routingmetric" value="bike/platzhalter" onclick="clickMetric()"> Platzhalter</td></tr>
            </table>
        </form>
    </div>
    </div>
    <div id="settingsPowermetric">
        <form name="routingmetricsettings">
            <table>
                <tr><td>Einstellungen: </td></tr>
                <tr><td>Maximalleistung (in Watt):</td></tr>
                <tr><td><input name="maxpower" type="text" value="150.0" size="15"></td></tr>
                <tr><td>Minimalgeschwindigkeit (in km/h):</td></tr>
                <tr><td><input name="minspeed" type="text" value="12.0" size="15"></td></tr>
                <tr><td>Gewicht (in kg, mit Fahrrad):</td></tr>
                <tr><td><input name="weight" type="text" value="90.0" size="15"></td></tr>
                <tr><td>Schiebegeschwindigkeit (in km/h):</td></tr>
                <tr><td><input name="pushbikespeed" type="text" value="2.5" size="15"></td></tr>
            </table>
        </form>
    </div>
    <div id="settingsSimpleheight">
        <form name="routingmetricsimpleheightsettings">
            <table>
                <tr><td>Einstellungen: </td></tr>
                <tr><td>Umweg / Höhenmeter:</td></tr>
                <tr><td><input name="adddistance" type="text" value="10.0" size="15"></td></tr>
            </table>
        </form>
    </div>
    <div id="settingsBikers">
        <form name="routingmetricbikers">
            <table>
                <tr><td><input type="radio" name="bikers" value="1"> <img src="img/133212667.png" width="30" height="30" alt=""></td>
                <td><input type="radio" name="bikers" value="2"> <img src="img/biker_erect.png" width="30" height="30" alt=""></td>
                <td><input type="radio" name="bikers" value="3"> <img src="img/biker_low.png" width="30" height="30" alt=""></td>
                <td><input type="radio" name="bikers" value="4"> <img src="img/stdbiker.png" width="30" height="30" alt=""></td></tr>
            </table>
        </form>
    </div>
    <div id="settingsNew">
        <form name="routingmetricnewsettings">
            <table>
                <tr><td>Platzhalter 1:</td></tr>
                <tr><td><input name="addparam" type="text" value="10.0" size="15"></td></tr>
                <tr><td>Platzhalter 2:</td></tr>
                <tr><td><input name="addparam" type="text" value="10.0" size="15"></td></tr>
            </table>
        </form>
    </div>
    <div id="display">
        Distance: <br>
        Time: 
    </div>
  </body>
</html>
